<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CryptoAlarm</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1a1a1a;
      color: white;
      text-align: center;
      padding: 20px;
    }

    input,
    button {
      padding: 10px;
      margin: 5px;
      border: none;
      border-radius: 5px;
    }

    button {
      background-color: #ab9ff2;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0ebeff;
    }

    a {
      color: #ab9ff2;
      text-decoration: none;
    }

    a:hover {
      color: grey;
      text-decoration: none;
    }
    footer{
      margin: 20px 20px;
      display: block;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 100%;
      padding: 20px;
      
    }
  </style>
</head>

<body>
  <h1>CryptoAlarm</h1>
  
  <form id="priceForm">
    <label for="token">ðŸª™</label>
    <input type="text" id="token" name="token" placeholder="Exemple : solana" required>
    <br>
    <label for="targetLowerPrice">ðŸ“‰</label>
    <input type="number" id="targetLowerPrice" name="targetLowerPrice" placeholder="Exemple : 192" required>
    <br>
    <label for="targetUpperPrice">ðŸ“ˆ</label>
    <input type="number" id="targetUpperPrice" name="targetUpperPrice" placeholder="Exemple : 200" required>
    <br>
    <button type="submit">Let's go</button>
  </form>

  <div id="solanaPriceDisplay" style="margin-top: 20px; font-size: 1.5em;">Prix du token : $0.00</div>
  <br>
  <footer>
    <p>code source <a href="https://github.com/berru-g/FiboScope/tree/main/wallet">github</a></p>
    <p>fibonacci tool <strong><a href="../index.html">FiboScope</a></strong></p>

    <p>all in one <strong><a href="index.html">Wallet</a></strong></p>
  </footer>
  <!-- Sons d'alarme -->
  <audio id="alarmSoundUpper"
    src="https://github.com/berru-g/Rick-MortySample/raw/master/PadMusical-master/public/rsc-mp3/Rick-sample/ricky_ticky_tabby_biatch.wav"
    preload="auto"></audio>
  <audio id="alarmSoundLower"
    src="https://github.com/berru-g/Rick-MortySample/raw/master/PadMusical-master/public/rsc-mp3/Rick-sample/Awww_Bitch.wav"
    preload="auto"></audio>

  <script>
    const alarmSoundUpper = document.getElementById('alarmSoundUpper');
    const alarmSoundLower = document.getElementById('alarmSoundLower');
    const solanaPriceDisplay = document.getElementById('solanaPriceDisplay');

    let tokenSymbol = ''; // Le token saisi par l'utilisateur
    let targetLowerPrice = 0; // Prix bas saisi par l'utilisateur
    let targetUpperPrice = 0; // Prix haut saisi par l'utilisateur

    // Ã‰coute l'Ã©vÃ©nement de soumission du formulaire
    document.getElementById('priceForm').addEventListener('submit', function (event) {
      event.preventDefault(); // EmpÃªche le rechargement de la page

      // RÃ©cupÃ¨re les valeurs saisies par l'utilisateur
      tokenSymbol = document.getElementById('token').value.toLowerCase();
      targetLowerPrice = parseFloat(document.getElementById('targetLowerPrice').value);
      targetUpperPrice = parseFloat(document.getElementById('targetUpperPrice').value);

      // DÃ©marre la surveillance du prix
      checkSolanaPrice();
      setInterval(checkSolanaPrice, 10000); // VÃ©rifie le prix toutes les 10 secondes
    });

    function checkSolanaPrice() {
      if (!tokenSymbol || !targetLowerPrice || !targetUpperPrice) {
        console.error('Veuillez saisir un token et des prix valides.');
        return;
      }

      fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${tokenSymbol}&vs_currencies=usd`)
        .then(response => response.json())
        .then(data => {
          const tokenPrice = data[tokenSymbol]?.usd;
          if (tokenPrice === undefined) {
            console.error(`Token "${tokenSymbol}" non trouvÃ©.`);
            solanaPriceDisplay.textContent = `Token "${tokenSymbol}" non trouvÃ©.`;
            return;
          }

          solanaPriceDisplay.textContent = `${tokenSymbol} : $${tokenPrice.toFixed(8)}`;

          if (tokenPrice < targetLowerPrice) {
            console.log('Le prix est descendu en dessous de la limite infÃ©rieure, dÃ©clenchement de l\'alarme descendante');
            playLowerAlarm();
            solanaPriceDisplay.textContent = `ðŸ‘‡ ${tokenSymbol} : $${tokenPrice.toFixed(2)}`;
            document.body.style.backgroundColor = '#ab9ff2';
            document.body.style.color = 'black';
          } else if (tokenPrice > targetUpperPrice) {
            console.log('Le prix a dÃ©passÃ© la limite supÃ©rieure, dÃ©clenchement de l\'alarme ascendante');
            playUpperAlarm();
            solanaPriceDisplay.textContent = `ðŸ‘† ${tokenSymbol} : $${tokenPrice.toFixed(2)}`;
            document.body.style.backgroundColor = '#0ebeff';
            document.body.style.color = 'black';
          } else {
            console.log('Le prix est dans la plage spÃ©cifiÃ©e');
            document.body.style.backgroundColor = '#1a1a1a';
            document.body.style.color = 'white';
          }
        })
        .catch(error => {
          console.error('Erreur lors de la rÃ©cupÃ©ration du prix :', error);
        });
    }

    function playUpperAlarm() {
      alarmSoundUpper.play();
    }

    function playLowerAlarm() {
      alarmSoundLower.play();
    }
  </script>
</body>

</html>